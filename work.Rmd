---
title: "Barbell movement analysis"
output: html_document
---

```{r, include=FALSE}
# setwd(file.path(normalizePath("~"),"kaggle","predmachlearn-034"))
library(caret)
library(dplyr)
```

We download the training dataset and set aside a quarter of the training data
to estimate out-of-sample error on our model.

```{r}
remote <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
loc <- basename(remote)
if(!file.exists(loc )) download.file(remote, loc)
if(!exists("loaded")) loaded <- read.csv(loc)
# Keep original data frame for console work caching and make a mutable copy
working <- loaded
set.seed(1000)
inTrain  <- createDataPartition(working$classe, p = 3/4, list=FALSE)
training <- working[ inTrain, ]
testing  <- working[-inTrain, ]
````

We look at the data and set aside any columns that contain NAs, hoping that
remaining variables will be sufficient for predictions. Later it's shown
that they are indeed sufficient, but it if wouldn't be, we could have returned
and try to handle NAs more
intelligently - for example, cut these variables to bins and make NAs another
bin.

```{r}
dim(working)
dim(training)
nas<-sapply(training, function(x) sum(is.na(x) | x==""))
trainingNotNA<-training[,names(nas[nas == 0])]
dim(trainingNotNA)
str(trainingNotNA)
```

Let's remove line numbers, user names and timestamps.

```{r}
head(working$X)
# OK, X is indeed observation number.
tr<-trainingNotNA[,-(1:5)]
```

Let's try fast classification tree first and see if it predicts well.

```{r, cache=TRUE}
set.seed(1)
mod<-train(classe~.,data=tr,method="rpart")
confusionMatrix(predict(mod, testing),testing$classe)
```

We see that prediction is weak. We try to normalize data first and it doesn't
help either.

```{r}
set.seed(1)
confusionMatrix(predict(train(classe~.,data=tr,method="rpart",
                              preProcess=c("center","scale")), testing),
                testing$classe)
```

We use Random Forest to improve weak trees and find that with default settings
accuracy is high: 99.68-99.93%.

```{r, cached=TRUE}
set.seed(1)
mod1<-train(classe~.,data=tr,method="rf")
confusionMatrix(predict(mod1, testing),testing$classe)
```